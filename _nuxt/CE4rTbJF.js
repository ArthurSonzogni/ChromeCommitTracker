import{V as Me,g as fe,i as z,q as V,s as F,v as me,o as Q,c as ne,x as K,a as G,Q as ge,j as Re}from"./BYXYRwLn.js";import{s as q,i as H}from"./nBtS1XGq.js";import{w as $e,c as C,m as de,_ as be}from"./B2tdp_o7.js";import{c as Te,n as De,l as Be,a as _e,b as Pe}from"./D7zcYHcO.js";import{_ as je}from"./DlAUqK2U.js";function ye(n){return Math.sign(n)*n*n}function ze(n){return Math.sign(n)*Math.sqrt(Math.abs(n))}function we(){var n=Te(),m=[0,1],b=!1,T;function v(f){var g=ze(n(f));return isNaN(g)?T:b?Math.round(g):g}return v.invert=function(f){return n.invert(ye(f))},v.domain=function(f){return arguments.length?(n.domain(f),v):n.domain()},v.range=function(f){return arguments.length?(n.range((m=Array.from(f,De)).map(ye)),v):m.slice()},v.rangeRound=function(f){return v.range(f).round(!0)},v.round=function(f){return arguments.length?(b=!!f,v):b},v.clamp=function(f){return arguments.length?(n.clamp(f),v):n.clamp()},v.unknown=function(f){return arguments.length?(T=f,v):T},v.copy=function(){return we(n.domain(),m).round(b).clamp(n.clamp()).unknown(T)},Me.apply(v,arguments),Be(v)}var Ee=0;function ke(){return new pe}function pe(){this._="@"+(++Ee).toString(36)}pe.prototype=ke.prototype={constructor:pe,get:function(n){for(var m=this._;!(m in n);)if(!(n=n.parentNode))return;return n[m]},set:function(n,m){return n[this._]=m},remove:function(n){return this._ in n&&delete n[this._]},toString:function(){return this._}};const xe=Math.abs,j=Math.atan2,W=Math.cos,Se=Math.max,ce=Math.min,S=Math.sin,J=Math.sqrt,E=1e-12,U=Math.PI,re=U/2,Ne=2*U;function qe(n){return n>1?0:n<-1?U:Math.acos(n)}function Ae(n){return n>=1?re:n<=-1?-re:Math.asin(n)}function Ce(n){return n.innerRadius}function We(n){return n.outerRadius}function Ie(n){return n.startAngle}function Oe(n){return n.endAngle}function Le(n){return n&&n.padAngle}function He(n,m,b,T,v,f,g,o){var M=b-n,c=T-m,a=g-v,y=o-f,i=y*M-a*c;if(!(i*i<E))return i=(a*(m-f)-y*(n-v))/i,[n+i*M,m+i*c]}function te(n,m,b,T,v,f,g){var o=n-b,M=m-T,c=(g?f:-f)/J(o*o+M*M),a=c*M,y=-c*o,i=n+a,h=m+y,w=b+a,x=T+y,P=(i+w)/2,d=(h+x)/2,r=w-i,u=x-h,l=r*r+u*u,p=v-f,A=i*x-w*h,R=(u<0?-1:1)*J(Se(0,p*p*l-A*A)),k=(A*u-r*R)/l,B=(-A*r-u*R)/l,_=(A*u+r*R)/l,D=(-A*r+u*R)/l,t=k-P,e=B-d,s=_-P,$=D-d;return t*t+e*e>s*s+$*$&&(k=_,B=D),{cx:k,cy:B,x01:-a,y01:-y,x11:k*(v/p-1),y11:B*(v/p-1)}}function Je(){var n=Ce,m=We,b=C(0),T=null,v=Ie,f=Oe,g=Le,o=null,M=$e(c);function c(){var a,y,i=+n.apply(this,arguments),h=+m.apply(this,arguments),w=v.apply(this,arguments)-re,x=f.apply(this,arguments)-re,P=xe(x-w),d=x>w;if(o||(o=a=M()),h<i&&(y=h,h=i,i=y),!(h>E))o.moveTo(0,0);else if(P>Ne-E)o.moveTo(h*W(w),h*S(w)),o.arc(0,0,h,w,x,!d),i>E&&(o.moveTo(i*W(x),i*S(x)),o.arc(0,0,i,x,w,d));else{var r=w,u=x,l=w,p=x,A=P,R=P,k=g.apply(this,arguments)/2,B=k>E&&(T?+T.apply(this,arguments):J(i*i+h*h)),_=ce(xe(h-i)/2,+b.apply(this,arguments)),D=_,t=_,e,s;if(B>E){var $=Ae(B/i*S(k)),I=Ae(B/h*S(k));(A-=$*2)>E?($*=d?1:-1,l+=$,p-=$):(A=0,l=p=(w+x)/2),(R-=I*2)>E?(I*=d?1:-1,r+=I,u-=I):(R=0,r=u=(w+x)/2)}var O=h*W(r),L=h*S(r),X=i*W(p),Y=i*S(p);if(_>E){var Z=h*W(u),ee=h*S(u),ae=i*W(l),oe=i*S(l),N;if(P<U)if(N=He(O,L,ae,oe,Z,ee,X,Y)){var se=O-N[0],ie=L-N[1],ue=Z-N[0],le=ee-N[1],ve=1/S(qe((se*ue+ie*le)/(J(se*se+ie*ie)*J(ue*ue+le*le)))/2),he=J(N[0]*N[0]+N[1]*N[1]);D=ce(_,(i-he)/(ve-1)),t=ce(_,(h-he)/(ve+1))}else D=t=0}R>E?t>E?(e=te(ae,oe,O,L,h,t,d),s=te(Z,ee,X,Y,h,t,d),o.moveTo(e.cx+e.x01,e.cy+e.y01),t<_?o.arc(e.cx,e.cy,t,j(e.y01,e.x01),j(s.y01,s.x01),!d):(o.arc(e.cx,e.cy,t,j(e.y01,e.x01),j(e.y11,e.x11),!d),o.arc(0,0,h,j(e.cy+e.y11,e.cx+e.x11),j(s.cy+s.y11,s.cx+s.x11),!d),o.arc(s.cx,s.cy,t,j(s.y11,s.x11),j(s.y01,s.x01),!d))):(o.moveTo(O,L),o.arc(0,0,h,r,u,!d)):o.moveTo(O,L),!(i>E)||!(A>E)?o.lineTo(X,Y):D>E?(e=te(X,Y,Z,ee,i,-D,d),s=te(O,L,ae,oe,i,-D,d),o.lineTo(e.cx+e.x01,e.cy+e.y01),D<_?o.arc(e.cx,e.cy,D,j(e.y01,e.x01),j(s.y01,s.x01),!d):(o.arc(e.cx,e.cy,D,j(e.y01,e.x01),j(e.y11,e.x11),!d),o.arc(0,0,i,j(e.cy+e.y11,e.cx+e.x11),j(s.cy+s.y11,s.cx+s.x11),d),o.arc(s.cx,s.cy,D,j(s.y11,s.x11),j(s.y01,s.x01),!d))):o.arc(0,0,i,p,l,d)}if(o.closePath(),a)return o=null,a+""||null}return c.centroid=function(){var a=(+n.apply(this,arguments)+ +m.apply(this,arguments))/2,y=(+v.apply(this,arguments)+ +f.apply(this,arguments))/2-U/2;return[W(y)*a,S(y)*a]},c.innerRadius=function(a){return arguments.length?(n=typeof a=="function"?a:C(+a),c):n},c.outerRadius=function(a){return arguments.length?(m=typeof a=="function"?a:C(+a),c):m},c.cornerRadius=function(a){return arguments.length?(b=typeof a=="function"?a:C(+a),c):b},c.padRadius=function(a){return arguments.length?(T=a==null?null:typeof a=="function"?a:C(+a),c):T},c.startAngle=function(a){return arguments.length?(v=typeof a=="function"?a:C(+a),c):v},c.endAngle=function(a){return arguments.length?(f=typeof a=="function"?a:C(+a),c):f},c.padAngle=function(a){return arguments.length?(g=typeof a=="function"?a:C(+a),c):g},c.context=function(a){return arguments.length?(o=a??null,c):o},c}const Fe=["width","height"],Ve=fe({__name:"TimelineWrappedChart",props:{repositories:{type:Array[String],default:()=>["chromium"]},developers:{type:Array},dates:{type:Array[Date]},author:{type:Boolean},review:{type:Boolean},stacked:{type:Boolean},hourlyParam:{type:Number},buckets:{type:Number,default:24}},setup(n){const m=[["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]],b=ke(),T=new Date,{$chromiumDataAll:v,$color:f}=ge(),g=n,o=z(null),M=z(null),c=z(null),a=z(null),y=z([]),i=z(300),h=z(300),w=V(()=>{switch(g.hourlyParam){case 0:return 24*60*60*1e3;case 1:return 7*24*60*60*1e3;case 2:return 365*24*60*60*1e3}return 0}),x=V(()=>{const l=y.value.map(R=>R.developer);let p=y.value;p=p.map(R=>{let k=R.data;g.author||(k=k.filter(_=>_.kind!="author")),g.review||(k=k.filter(_=>_.kind!="review"));const B=k.map(_=>new Date(_.date)).sort((_,D)=>_-D).filter(_=>_>=g.dates[0]&&_<=g.dates[1]);return{developer:R.developer,values:B.map(_=>(T-_)%w.value/w.value)}});let A=new Array(g.buckets).fill(0);return p=p.map(R=>{const k=[...A];R.values.forEach(_=>{k[Math.floor(_*g.buckets)]++});const B={developer:R.developer,values:k.map((_,D)=>({angle:D,buckets:g.buckets,inner:A[D],outer:k[D],developer:R.developer}))};return A=g.stacked?k:new Array(g.buckets).fill(0),B}),p=p.map(R=>R.values).flat(),{developers:l,arcs:p}}),P=V(()=>de(x.value.arcs.map(l=>l.outer))),d=async()=>{y.value=await v(g.repositories,g.developers)},r=()=>{try{i.value=o.value.clientWidth,i.value=Math.min(i.value,800),i.value=Math.min(i.value,window.innerWidth*.8),i.value=Math.min(i.value,Math.max(0,(window.innerHeight-300)*.9)),h.value=i.value}catch(l){console.log(l)}d(),u(),window.addEventListener("resize",r)},u=()=>{q(M.value).attr("transform",`translate(${i.value/2}, ${h.value/2})`),q(c.value).attr("transform",`translate(${i.value/2}, ${h.value/2})`);const l=Math.max(i.value,h.value)*.2,p=Math.max(i.value,h.value)*.5,A=_e().domain([0,g.buckets]).range([0,2*Math.PI]),R=we().domain([0,P.value]).range([l,p]),k=t=>({startAngle:A(t.angle),endAngle:A(t.angle+1),padAngle:A(.05),innerRadius:R(t.inner),outerRadius:R(t.outer)}),B=function(t,e){return function(s){const $={startAngle:H(t.startAngle,e.startAngle)(s),endAngle:H(t.endAngle,e.endAngle)(s),innerRadius:H(t.innerRadius,e.innerRadius)(s),outerRadius:H(t.outerRadius,e.outerRadius)(s),padAngle:H(t.padAngle,e.padAngle)(s)};return b.set(this,$),_($)}},_=Je().innerRadius(t=>t.innerRadius).outerRadius(t=>t.outerRadius).startAngle(t=>-t.endAngle).endAngle(t=>-t.startAngle).padAngle(t=>t.padAngle).cornerRadius(t=>t.padAngle*1e3);q(M.value).selectAll("path").data(x.value.arcs,t=>`${t.developer}-${t.angle}-${t.buckets}`).join(t=>t.append("path").attr("fill",e=>f(e.developer)).attr("d",e=>_(k(e))).attr("opacity",0).transition().duration(1e3).attr("opacity",.5).attrTween("d",function(e){const s=k({angle:e.angle,inner:0,outer:0}),$=k(e);return B(s,$)}),t=>t.transition().duration(1e3).attr("opacity",.5).attrTween("d",function(e){const s=b.get(this),$=k(e);return B(s,$)}),t=>t.transition().duration(1e3).attr("opacity",0).attrTween("d",function(e){const s=b.get(this),$=k({angle:0,padAngle:0,inner:0,outer:0});return $.startAngle=s.startAngle,$.endAngle=s.endAngle,$.padAngle=s.padAngle,B(s,$)}).remove());const D=m[g.hourlyParam].map((t,e)=>{const $=(T-new Date("2000-01-03T00:00:00.000"))%w.value/w.value,I=e/m[g.hourlyParam].length;return{text:t,angle:(I-$-.25)*360}});q(c.value).selectAll("text").data(D,t=>`${t.text}-${t.angle}`).join(t=>t.append("text").attr("x",l*.5).attr("y",0).attr("text-anchor","end").attr("alignment-baseline","middle").attr("opacity",1).text(e=>e.text).attr("transform",e=>`rotate(${e.angle})`).transition().duration(1e3).attr("font-size",l*.1).attr("x",l*.9).attr("opacity",.5),t=>t.transition().duration(1e3).attr("font-size",l*.1).attr("x",l*.9).attr("opacity",.5),t=>t.transition().duration(1e3).attr("x",l*1).attr("opacity",0).remove()),q(a.value).selectAll(".legend").data(x.value.developers,t=>t).join(t=>{const e=t.append("g").attr("class","legend");return e.attr("opacity",0).attr("transform",(s,$)=>`translate(100, ${$*20+20})`).transition().duration(500).attr("transform",(s,$)=>`translate(10, ${$*20+20})`).attr("opacity",1),e.append("text").attr("font-size","12px").attr("font-weight","bold").attr("fill",s=>f(s)).text(s=>s),e},t=>(t.transition().duration(1e3).attr("transform",(e,s)=>`translate(10, ${s*20+20})`).attr("opacity",1),t),t=>{t.transition().duration(500).attr("transform",(e,s)=>`translate(100, ${s*20+20})`).attr("opacity",0).remove()})};return F(()=>g.developers,d),F(()=>g.repositories,d),F(x,u),me(r),(l,p)=>(Q(),ne("div",{ref_key:"container",ref:o,align:"center"},[(Q(),ne("svg",{ref:"svg",width:K(i),height:K(h)},[G("g",{ref_key:"arcs",ref:M},null,512),G("g",{ref_key:"indicators",ref:c},null,512),G("g",{ref_key:"legend",ref:a},null,512)],8,Fe))],512))}}),Ze=je(Ve,[["__scopeId","data-v-253367c3"]]),et=fe({__name:"TimelineChart",props:{repositories:{type:Array,default:()=>["chromium"]},developers:{type:Array},dates:{type:Array},author:{type:Boolean},review:{type:Boolean},stacked:{type:Boolean}},setup(n){const m=n,b=z([]),{$chromiumDataAll:T}=ge(),v=V(()=>{let o=b.value.map(M=>{let c=M.data;m.author||(c=c.filter(y=>y.kind!="author")),m.review||(c=c.filter(y=>y.kind!="review"));const a=c.map(y=>new Date(y.date)).sort((y,i)=>y-i).filter(y=>y>=m.dates[0]&&y<=m.dates[1]);return{label:M.developer,values:a}});if(m.stacked){let M=[];o=o.map(c=>(M=M.concat(c.values).sort((a,y)=>a-y),{label:c.developer,values:M}))}return o=o.map(M=>{let c=0;return{label:M.label,values:M.values.map(a=>(c++,{x:a,y:c}))}}),o}),f=async()=>{const o=await T(m.repositories[0],m.developers);b.value=o};F(()=>[m.developers,m.repositories],f);const g=()=>{f()};return me(()=>{g()}),(o,M)=>{const c=be;return Q(),Re(c,{data:K(v)},null,8,["data"])}}}),Ge=["width","height"],tt=fe({__name:"PeersChart",props:{repositories:{type:Array[String],default:()=>["chromium"]},developers:{type:Array},dates:{type:Array[Date]},author:{type:Boolean},review:{type:Boolean},stacked:{type:Boolean},take_n:{type:Number,default:60}},setup(n){const{$chromiumDataAll:m,$color:b}=ge(),T=z(null),v=z(null),f=z(null),g=z(null),o=n,M=z([]),c=z(300),a=z(300);F(()=>[o.developers,o.repositories],async()=>{M.value=await m(o.repositories[0],o.developers)});const y=V(()=>{const w=M.value.map(d=>{let r=d.data.filter(p=>{const A=new Date(p.date);return A>=o.dates[0]&&A<=o.dates[1]});o.author||(r=r.filter(p=>p.kind!="author")),o.review||(r=r.filter(p=>p.kind!="review"));const u=r.map(p=>p.peers).flat(),l={};return u.forEach(p=>{l[p]||(l[p]=0),l[p]++}),{developer:d.developer,peers:l}}),x={};w.forEach(d=>{Object.entries(d.peers).forEach(([r,u])=>{x[r]||(x[r]={}),x[r][d.developer]=u})});for(const d in x){let r=0;Object.entries(x[d]).forEach(([u,l])=>{x[d][u]={left:r,right:r+l},o.stacked&&(r+=l)})}const P=[];for(const d in x){let r=0;Object.entries(x[d]).forEach(([,u])=>{r=Math.max(r,u.right)}),P.push({peer:d,developers:Object.entries(x[d]).map(([u,l])=>({developer:u,left:l.left,right:l.right})),max:r})}return P.sort((d,r)=>r.max-d.max),P.splice(0,o.take_n)}),i=()=>{const w=_e().domain([0,de(y.value,r=>de(r.developers,u=>u.right))]).range([0,c.value-200]),x=Pe(w);q(f.value).attr("transform","translate(130, 25)").transition().duration(500).call(x),q(g.value).attr("transform","translate(130, 50)");const P=r=>{r.transition().duration(500).attr("opacity",1).attr("transform",(u,l)=>`translate(0, ${l*20})`)},d=r=>{r.transition().duration(500).attr("opacity",.5).attr("x",u=>w(u.left)).attr("width",u=>w(u.right-u.left))};q(g.value).selectAll("g").data(y.value,r=>r.peer).join(r=>{const u=r.append("g");return u.attr("opacity",0).attr("transform",(A,R)=>`translate(-100, ${R*20})`),P(u),u.append("text").attr("class","peer").text(A=>A.peer).attr("text-anchor","end").attr("text-baseline","middle").attr("x",-5).attr("color",A=>b(A.peer)),u.append("text").attr("class","value").text(A=>A.max).attr("text-anchor","start").attr("text-baseline","bottom").attr("x",A=>w(A.max)+5),u},r=>{const u=r;return P(u),u.select(".value").transition().duration(500).attr("x",p=>w(p.max)).textTween((p,A,R)=>{const k=q(R[A]).text(),B=H(k,p.max);return _=>Math.round(B(_))}),u},r=>(r.transition().duration(500).attr("opacity",0).attr("transform",(u,l)=>`translate(100, ${l*20})`).remove(),r)).selectAll("rect").data(r=>r.developers,r=>r.developer).join(r=>{const u=r.append("rect").attr("opacity",0).attr("rx",5).attr("ry",5).attr("x",l=>w(l.left)).attr("y",-15).attr("width",l=>w(l.right-l.left)).attr("height",19).attr("fill",l=>b(l.developer));return d(u),u},r=>{const u=r;return d(u),u},r=>(r.transition().duration(500).attr("opacity",0).remove(),r))};F(y,i);const h=async()=>{a.value=o.take_n*20+50,c.value=T.value.clientWidth,i(),window.addEventListener("resize",h)};return me(()=>{h()}),(w,x)=>(Q(),ne("div",{ref_key:"container",ref:T,align:"center"},[(Q(),ne("svg",{ref_key:"svg",ref:v,width:K(c),height:K(a)},[G("g",{ref_key:"axis",ref:f},null,512),G("g",{ref_key:"authors",ref:g},null,512)],8,Ge))],512))}});export{Ze as _,et as a,tt as b};
