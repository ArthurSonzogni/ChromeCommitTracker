import{_ as _e}from"./BgwZxOQs.js";import{_ as ye}from"./Dr1fThoD.js";import{W as xe,V as be,g as se,m as ke,h as we,i as I,q as Ve,s as ue,v as Me,r as F,o as O,c as C,b as _,w as x,x as v,y as j,F as Ie,k as Ae,t as Se,d as A,j as Q,z as W,Q as ne,n as je,l as qe,a as Y}from"./BYXYRwLn.js";import{s as T,t as ae,i as re}from"./nBtS1XGq.js";import{b as oe,a as Oe}from"./D7zcYHcO.js";import{f as le}from"./D2nGpDRe.js";import{l as Re}from"./ntdiYfc-.js";import{_ as Ue}from"./DlAUqK2U.js";import"./CTRyl4Lp.js";function ie(f,b,p){f=+f,b=+b,p=(s=arguments.length)<2?(b=f,f=0,1):s<3?1:+p;for(var e=-1,s=Math.max(0,Math.ceil((b-f)/p))|0,w=new Array(s);++e<s;)w[e]=f+e*p;return w}function de(){var f=xe().unknown(void 0),b=f.domain,p=f.range,e=0,s=1,w,k,q=!1,u=0,V=0,S=.5;delete f.unknown;function h(){var l=b().length,R=s<e,m=R?s:e,z=R?e:s;w=(z-m)/Math.max(1,l-u+V*2),q&&(w=Math.floor(w)),m+=(z-m-w*(l-u))*S,k=w*(1-u),q&&(m=Math.round(m),k=Math.round(k));var L=ie(l).map(function(P){return m+w*P});return p(R?L.reverse():L)}return f.domain=function(l){return arguments.length?(b(l),h()):b()},f.range=function(l){return arguments.length?([e,s]=l,e=+e,s=+s,h()):[e,s]},f.rangeRound=function(l){return[e,s]=l,e=+e,s=+s,q=!0,h()},f.bandwidth=function(){return k},f.step=function(){return w},f.round=function(l){return arguments.length?(q=!!l,h()):q},f.padding=function(l){return arguments.length?(u=Math.min(1,V=+l),h()):u},f.paddingInner=function(l){return arguments.length?(u=Math.min(1,l),h()):u},f.paddingOuter=function(l){return arguments.length?(V=+l,h()):V},f.align=function(l){return arguments.length?(S=Math.max(0,Math.min(1,l)),h()):S},f.copy=function(){return de(b(),[e,s]).round(q).paddingInner(u).paddingOuter(V).align(S)},be.apply(h(),arguments)}const $e=["value"],Ce=["width"],Ne=["width","height"],ze=["width"],G=100,Be=se({__name:"Leaderboard",props:ke({repositories:{type:Array[String],default:()=>["chromium"]},grouping:{type:String,default:"yearly"},kind:{type:String,default:"author"}},{timeIndex:{},timeIndexModifiers:{}}),emits:["update:timeIndex"],setup(f){const{$usersInfo:b}=ne(),{$color:p}=ne();let e=we(f,"timeIndex");const s=f,w=I(null),k=I(null),q=I(null),u=I(null);I("instant");const V=I(300),S=I(300),h=I([]),l=I(!1);Ve(()=>{switch(s.grouping){case"forever":return"Forever";case"yearly":return"Year";case"decennial":return"Decade";case"quarterly":return"Quarter";case"monthly":return"Month"}return"N/A"});const R=i=>{const t={};for(const a of i)Object.entries(a).forEach(([n,r])=>{t[n]||(t[n]={}),Object.entries(r).forEach(([o,d])=>{var c;(c=t[n])[o]||(c[o]=0),t[n][o]+=d})});return t},m=i=>{const t=[],a=Object.keys(i),n=new Set;for(const r of a)for(const o of Object.keys(i[r]))n.add(o);h.value=Array.from(n).sort((r,o)=>r<o?1:-1),e.value>=h.value.length&&(e.value=h.value.length-1);for(const r of h.value){const o={date:r,users:[]};for(const d of a)i[d][r]&&o.users.push([d,i[d][r]]);o.users.sort((d,c)=>c[1]-d[1]),o.users.splice(G*2),t.push(o)}return t},z=async()=>{l.value=!1;const i=await Promise.all(s.repositories.map(o=>b(o,s.grouping,s.kind))),t=R(i),a=m(t);a.sort((o,d)=>d.date>o.date?-1:1);const n=ae().duration(500),r=Math.min(Math.max(e.value,0),a.length-1);e.value!=r&&(e.value=r),Z(a[a.length-e.value-1],n)},L=i=>{const t=i.append("g");return(a,n)=>{const r=oe(a).ticks(V.value/100).tickSizeOuter(0).tickSizeInner(-S.value+100).tickFormat(o=>le(".2s")(o).replace("G","B"));t.transition(n).call(r),t.select(".tick:first-of-type text").remove(),t.selectAll(".tick:not(:first-of-type) line").attr("stroke","white"),t.select(".domain").remove(),t.attr("opacity",.2)}},P=i=>{const t=i.append("g").attr("transform","translate(0, 30)");return(a,n)=>{const r=oe(a).ticks(V.value/100);t.transition(n).call(r)}},ce=i=>{const t=i.append("g");return(a,n,r,o)=>{const d=r.users.length,c=y=>y.transition(o).attr("transform",(g,$)=>`translate(0, ${n($)})`).attr("opacity",1),M=y=>y.transition(o).attr("width",g=>a(g[1])-a(0)),U=y=>y.transition(o).attr("x",g=>a(g[1])+(a(g[1])<80?7:-7)).attr("text-anchor",g=>a(g[1])<80?"start":"end").text(g=>g[0]),D=y=>y.transition(o).attr("x",g=>a(g[1])+(a(g[1])<80?7:-7)).attr("text-anchor",g=>a(g[1])<80?"start":"end").textTween(function(g){const $=g[1];this._current||(this._current=0);const B=re(this._current,$);return this._current=$,E=>{const N=Math.round(B(E));return N<100?Math.round(N):le(".3s")(N)}}),te=y=>y.transition(o).textTween(function(g,$){const B=$+1;this._current||(this._current=0);const E=re(this._current,B);return this._current=B,N=>Math.round(E(N))});t.selectAll("g").data(r.users.slice(0,G),y=>y[0]).join(y=>{const g=y.append("g");return g.attr("transform",`translate(1, ${n.bandwidth()*d})`).attr("opacity",0).call(c),g.append("rect").attr("fill",he=>p(he[0])).attr("opacity",.5).attr("x",a(0)).attr("height",n.bandwidth()).call(M),g.append("text").classed("index",!0).attr("fill","black").attr("dy","0.35em").attr("dx",0).attr("dy",n.bandwidth()/2).attr("alignment-baseline","middle").call(te),g.append("text").classed("name",!0).attr("fill","black").attr("dy","0.35em").attr("dx",5).attr("y",10).call(U),g.append("text").classed("commit",!0).attr("fill","gray").attr("dy","0.35em").attr("dx",5).attr("y",30).text(0).call(D),g},y=>(y.call(c),y.select("rect").call(M),y.select(".index").call(te),y.select(".name").call(U),y.select(".commit").call(D),y),y=>{const g=y;return y.transition(o).attr("transform",`translate(1, ${n.bandwidth()*d})`).attr("opacity",0).remove(),g})}},me=(i,t=10)=>{const a=[];for(let n=0;n<i.length-1;n++){a.push(i[n]);const r={},o={};for(const[c,M]of i[n].users)r[c]=M;for(const[c,M]of i[n+1].users)o[c]=M;const d=new Set([...Object.keys(r),...Object.keys(o)]);for(let c=1;c<t;c++){const M=[];for(const U of d)M.push([U,(t-c)/t*(r[U]||0)+(0+c)/t*(o[U]||0)]);M.sort((U,D)=>D[1]-U[1]),a.push({date:i[n].date,users:M})}}return a.push(i[i.length-1]),a},pe=i=>{const t={};for(const a of i){for(const[n,r]of a.users)t[n]||(t[n]=0),t[n]+=r;a.users=[];for(const[n,r]of Object.entries(t))a.users.push([n,r]);a.users.sort((n,r)=>r[1]-n[1])}},H=async(i=!1)=>{if(l.value){l.value=!1;return}const t=await Promise.all(s.repositories.map(c=>b(c,s.grouping,s.kind))),a=R(t),n=m(a);n.sort((c,M)=>c.date>M.date?-1:1),n.length=Math.min(n.length,Math.max(2,e.value+1)),n.sort((c,M)=>c.date<M.date?-1:1),i&&pe(n);let r=0;const o=5,d=me(n,o);for(r*=o,l.value=!0;r<d.length-1&&l.value;){r++;const c=ae().duration(2e3/o).ease(Re);Z(d[r],c),await c.end()}l.value=!1},fe=()=>{l.value=!1},ge=()=>{e.value=Math.min(e.value+1,h.value.length-1)},ve=()=>{e.value=Math.max(e.value-1,0)};ue(s,z);let J=null,K=null,X=null;const Z=(i,t)=>{if(!i)return;const a=d=>d.attr("x",V.value-10).attr("y",48).transition(t).text(c=>c);T(u.value).selectAll("text").data([i.date],d=>d).join(d=>{const c=d.append("text");return c.text(M=>M).attr("text-anchor","end").attr("transform","translate(0, 32)").attr("opacity",0).attr("font-size","2em"),c.transition(t).attr("transform","translate(0, 0)").attr("opacity",1),a(c)},d=>a(d.transition(t)),d=>d.transition(t).attr("transform","translate(0, -32)").attr("opacity",0).remove());const n=Math.max(...i.users.map(d=>d[1])),r=Oe().domain([0,n]).range([25,V.value-10]),o=de().domain(ie(G+1)).range([0,S.value-60]).padding(.1);J(r,o,i,t),K(r,t),X(r,t)},ee=()=>{w.value&&(V.value=w.value.clientWidth,S.value=G*50,z())};return window.addEventListener("resize",ee),Me(()=>{J=ce(T(k.value)),K=L(T(k.value)),X=P(T(q.value)),ee()}),(i,t)=>{const a=F("b-field"),n=F("b-select"),r=F("b-button");return O(),C("div",{ref_key:"container",ref:w,align:"center"},[_(a,{grouped:"","group-multiline":"",label:"time"},{default:x(()=>[_(a),_(a,null,{default:x(()=>[_(n,{modelValue:v(e),"onUpdate:modelValue":t[0]||(t[0]=o=>j(e)?e.value=o:e=o)},{default:x(()=>[(O(!0),C(Ie,null,Ae(v(h),(o,d)=>(O(),C("option",{key:d,value:d},Se(o),9,$e))),128))]),_:1},8,["modelValue"])]),_:1}),_(a,{grouped:""},{default:x(()=>[_(r,{onClick:ge,disabled:v(e)==v(h).length-1},{default:x(()=>[A(" Previous ")]),_:1},8,["disabled"]),_(r,{onClick:ve,disabled:v(e)==0},{default:x(()=>[A(" Next ")]),_:1},8,["disabled"])]),_:1}),!v(l)&&f.grouping!="forever"&&v(e)>0?(O(),Q(a,{key:0},{default:x(()=>[_(r,{onClick:t[1]||(t[1]=o=>H(!1)),class:"is-success"},{default:x(()=>[A(" Animate ")]),_:1})]),_:1})):W("",!0),!v(l)&&f.grouping!="forever"&&v(e)>0?(O(),Q(a,{key:1},{default:x(()=>[_(r,{onClick:t[2]||(t[2]=o=>H(!0)),class:"is-warning"},{default:x(()=>[A(" Animate with accumulation ")]),_:1})]),_:1})):W("",!0),v(l)?(O(),Q(a,{key:2},{default:x(()=>[_(r,{onClick:fe,class:"is-danger"},{default:x(()=>[A(" Stop ")]),_:1})]),_:1})):W("",!0)]),_:1}),(O(),C("svg",{ref_key:"svg_axis",ref:q,width:v(V),height:31,class:"sticky-top"},null,8,Ce)),(O(),C("svg",{ref_key:"svg",ref:k,width:v(V),height:v(S)},null,8,Ne)),(O(),C("svg",{ref_key:"svg_title",ref:u,width:v(V),height:80,class:"sticky-bottom"},null,8,ze))],512)}}}),Fe=Ue(Be,[["__scopeId","data-v-9ee442ea"]]),Le={class:"section"},De={class:"container"},Ee=Y("h1",{class:"title"},"Leaderboard",-1),Xe=se({__name:"leaderboard",setup(f){const b=I(["chromium"]),p=I("yearly"),e=I("author"),s=I(0),w=je(),k=qe();return k.query.repositories&&(b.value=k.query.repositories.split(",")),k.query.grouping&&(p.value=k.query.grouping),k.query.kind&&(e.value=k.query.kind),k.query.timeIndex&&(s.value=parseInt(k.query.timeIndex)),ue([b,p,e,s],()=>{w.replace({query:{repositories:b.value.join(","),grouping:p.value,kind:e.value,timeIndex:s.value.toString()}})}),(q,u)=>{const V=_e,S=ye,h=F("b-radio-button"),l=F("b-field"),R=Fe;return O(),C("div",null,[_(V),Y("section",Le,[Y("div",De,[Ee,_(S,{modelValue:v(b),"onUpdate:modelValue":u[0]||(u[0]=m=>j(b)?b.value=m:null),size:"medium",allowMultiple:!0,allowAll:!0},null,8,["modelValue"]),_(l,{grouped:"","group-multiline":""},{default:x(()=>[_(l,{label:"As:"},{default:x(()=>[_(h,{name:"kind",modelValue:v(e),"onUpdate:modelValue":u[1]||(u[1]=m=>j(e)?e.value=m:null),"native-value":"author"},{default:x(()=>[A(" author ")]),_:1},8,["modelValue"]),_(h,{name:"kind",modelValue:v(e),"onUpdate:modelValue":u[2]||(u[2]=m=>j(e)?e.value=m:null),"native-value":"review"},{default:x(()=>[A(" Review ")]),_:1},8,["modelValue"]),_(h,{name:"kind",modelValue:v(e),"onUpdate:modelValue":u[3]||(u[3]=m=>j(e)?e.value=m:null),"native-value":"both"},{default:x(()=>[A(" both ")]),_:1},8,["modelValue"])]),_:1}),_(l,{label:"Grouping:"},{default:x(()=>[_(h,{name:"grouping",modelValue:v(p),"onUpdate:modelValue":u[4]||(u[4]=m=>j(p)?p.value=m:null),"native-value":"forever"},{default:x(()=>[A(" Forever ")]),_:1},8,["modelValue"]),_(h,{name:"grouping",modelValue:v(p),"onUpdate:modelValue":u[5]||(u[5]=m=>j(p)?p.value=m:null),"native-value":"decennial"},{default:x(()=>[A(" Decennial ")]),_:1},8,["modelValue"]),_(h,{name:"grouping",modelValue:v(p),"onUpdate:modelValue":u[6]||(u[6]=m=>j(p)?p.value=m:null),"native-value":"yearly"},{default:x(()=>[A(" Yearly ")]),_:1},8,["modelValue"]),_(h,{name:"grouping",modelValue:v(p),"onUpdate:modelValue":u[7]||(u[7]=m=>j(p)?p.value=m:null),"native-value":"quarterly"},{default:x(()=>[A(" Quarterly ")]),_:1},8,["modelValue"]),_(h,{name:"grouping",modelValue:v(p),"onUpdate:modelValue":u[8]||(u[8]=m=>j(p)?p.value=m:null),"native-value":"monthly"},{default:x(()=>[A(" Monthly ")]),_:1},8,["modelValue"])]),_:1})]),_:1}),_(R,{repositories:v(b),grouping:v(p),kind:v(e),timeIndex:v(s),"onUpdate:timeIndex":u[9]||(u[9]=m=>j(s)?s.value=m:null)},null,8,["repositories","grouping","kind","timeIndex"])])])])}}});export{Xe as default};
